# ============================================================================
# Base Configuration (applies to all environments)
# ============================================================================

quarkus.openapi.generator.input-base-dir=docs
quarkus.openapi.generator.spec=api.yaml
quarkus.openapi.generator.base-package=com.datadoghq.stickerlandia.stickercatalogue

# Logging
quarkus.otel.sdk.disabled=true
quarkus.log.json.fields.mdc.flat-fields=true

# Database
quarkus.datasource.db-kind=postgresql

# Hibernate ORM
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.log.sql=true

# Flyway
quarkus.flyway.migrate-at-start=true
quarkus.flyway.table=flyway_schema_history
quarkus.flyway.locations=db/migration

# S3 Configuration
sticker.images.bucket=sticker-images

# Messaging provider selection (kafka or aws)
MESSAGING_PROVIDER=kafka

# EventBridge configuration
quarkus.eventbridge.aws.region=${AWS_REGION:us-east-1}
quarkus.eventbridge.aws.credentials.type=default

# Kafka channel configuration - DISABLED by default
# These settings are required because @Channel annotations cause build-time wiring.
# The channels are disabled and won't actually connect unless enabled by a profile.
mp.messaging.outgoing.stickers_added.enabled=false
mp.messaging.outgoing.stickers_added.topic=stickers.stickerAdded.v1
mp.messaging.outgoing.stickers_added.value.serializer=com.datadoghq.stickerlandia.common.messaging.CloudEventSerializer

mp.messaging.outgoing.stickers_updated.enabled=false
mp.messaging.outgoing.stickers_updated.topic=stickers.stickerUpdated.v1
mp.messaging.outgoing.stickers_updated.value.serializer=com.datadoghq.stickerlandia.common.messaging.CloudEventSerializer

mp.messaging.outgoing.stickers_deleted.enabled=false
mp.messaging.outgoing.stickers_deleted.topic=stickers.stickerDeleted.v1
mp.messaging.outgoing.stickers_deleted.value.serializer=com.datadoghq.stickerlandia.common.messaging.CloudEventSerializer

# ============================================================================
# Dev Profile - Local development with DevServices
# Activated by: ./mvnw quarkus:dev (automatic) or QUARKUS_PROFILE=dev
# ============================================================================

%dev.quarkus.datasource.devservices.enabled=true
%dev.quarkus.s3.devservices.buckets=sticker-images
%dev.quarkus.kafka.devservices.enabled=true
%dev.quarkus.kafka.devservices.topic-partitions.stickers.stickerAdded.v1=1
%dev.quarkus.kafka.devservices.topic-partitions.stickers.stickerUpdated.v1=1
%dev.quarkus.kafka.devservices.topic-partitions.stickers.stickerDeleted.v1=1

# Enable Kafka channels in dev
%dev.mp.messaging.outgoing.stickers_added.enabled=true
%dev.mp.messaging.outgoing.stickers_added.connector=smallrye-kafka
%dev.mp.messaging.outgoing.stickers_updated.enabled=true
%dev.mp.messaging.outgoing.stickers_updated.connector=smallrye-kafka
%dev.mp.messaging.outgoing.stickers_deleted.enabled=true
%dev.mp.messaging.outgoing.stickers_deleted.connector=smallrye-kafka

# ============================================================================
# Prod Profile - Base production configuration
# Not used directly - use prod-kafka or prod-aws
# ============================================================================

%prod.quarkus.datasource.devservices.enabled=false
%prod.quarkus.kafka.devservices.enabled=false
%prod.quarkus.s3.devservices.enabled=false

# ============================================================================
# Prod-Kafka Profile - Production with Kafka messaging
# Activated by: QUARKUS_PROFILE=prod-kafka
# Required env vars: KAFKA_BOOTSTRAP_SERVERS, database credentials, S3 config
# ============================================================================

%prod-kafka.quarkus.config.profile.parent=prod

# Enable Kafka channels in prod-kafka
%prod-kafka.mp.messaging.outgoing.stickers_added.enabled=true
%prod-kafka.mp.messaging.outgoing.stickers_added.connector=smallrye-kafka
%prod-kafka.mp.messaging.outgoing.stickers_updated.enabled=true
%prod-kafka.mp.messaging.outgoing.stickers_updated.connector=smallrye-kafka
%prod-kafka.mp.messaging.outgoing.stickers_deleted.enabled=true
%prod-kafka.mp.messaging.outgoing.stickers_deleted.connector=smallrye-kafka

# ============================================================================
# Prod-AWS Profile - Production with AWS EventBridge messaging
# Activated by: QUARKUS_PROFILE=prod-aws
# Required env vars: EVENT_BUS_NAME, AWS_REGION, database credentials
# Kafka channels remain DISABLED (default from base config)
# ============================================================================

%prod-aws.quarkus.config.profile.parent=prod
%prod-aws.MESSAGING_PROVIDER=aws
