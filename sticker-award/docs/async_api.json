{
  "asyncapi": "2.4.0",
  "info": {
    "title": "Sticker Award Service",
    "version": "1.0.0",
    "description": "Async API for sticker assignment events and certification integration"
  },
  "defaultContentType": "application/json",
  "channels": {
    "stickers.stickerAssignedToUser.v1": {
      "publish": {
        "operationId": "PublishStickerAssignedToUserEventV1",
        "summary": "Published when a sticker is assigned to a user",
        "message": {
          "$ref": "#/components/messages/stickerAssignedToUserEvent"
        }
      }
    },
    "stickers.stickerRemovedFromUser.v1": {
      "publish": {
        "operationId": "PublishStickerRemovedFromUserEventV1",
        "summary": "Published when a sticker is removed from a user",
        "message": {
          "$ref": "#/components/messages/stickerRemovedFromUserEvent"
        }
      }
    },
    "users.stickerClaimed.v1": {
      "publish": {
        "operationId": "PublishStickerClaimedEventV1",
        "summary": "Published when a user claims a sticker",
        "message": {
          "$ref": "#/components/messages/stickerClaimedEventV1"
        }
      }
    },
    "certifications.certificationCompleted.v1": {
      "subscribe": {
        "operationId": "ProcessCertificationCompletedEventAsync",
        "summary": "Subscribed to assign stickers based on completed certifications",
        "message": {
          "$ref": "#/components/messages/certificationCompletedEventV1"
        }
      }
    },
    "users.userRegistered.v1": {
      "subscribe": {
        "operationId": "ProcessUserRegisteredEventAsync",
        "summary": "Subscribed to assign welcome stickers to newly registered users",
        "message": {
          "$ref": "#/components/messages/userRegisteredEventV1"
        }
      }
    }
  },
  "components": {
    "schemas": {
      "cloudEvent": {
        "id": "cloudEvent",
        "type": "object",
        "description": "CloudEvents v1.0 specification compliant wrapper",
        "additionalProperties": false,
        "properties": {
          "specversion": {
            "type": "string",
            "const": "1.0",
            "description": "CloudEvents specification version"
          },
          "type": {
            "type": "string",
            "description": "Event type identifier (typically the topic name)"
          },
          "source": {
            "type": "string",
            "description": "Source service that produced the event"
          },
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier for this event instance"
          },
          "time": {
            "type": "string",
            "format": "date-time",
            "description": "RFC3339 timestamp when the event was created"
          },
          "traceparent": {
            "type": "string",
            "pattern": "^00-[0-9a-f]{32}-[0-9a-f]{16}-[0-9a-f]{2}$",
            "description": "W3C trace context for distributed tracing"
          }
        },
        "required": ["specversion", "type", "source", "id", "time"]
      },
      "domainEvent": {
        "id": "domainEvent",
        "type": "object",
        "x-abstract": true,
        "additionalProperties": false,
        "properties": {
          "eventName": {
            "type": "string"
          },
          "eventVersion": {
            "type": "string"
          }
        }
      },
      "stickerAssignedToUserEventData": {
        "id": "stickerAssignedToUserEventData",
        "allOf": [
          {
            "$ref": "#/components/schemas/domainEvent"
          },
          {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "eventName": {
                "type": "string",
                "const": "StickerAssignedToUser"
              },
              "eventVersion": {
                "type": "string",
                "const": "v1"
              },
              "accountId": {
                "type": "string",
                "description": "The user who was assigned the sticker"
              },
              "stickerId": {
                "type": "string",
                "description": "The sticker that was assigned"
              },
              "assignedAt": {
                "type": "string",
                "format": "date-time",
                "description": "RFC3339 timestamp when the assignment occurred"
              },
              "reason": {
                "type": "string",
                "description": "Optional reason for the assignment (omitted if not provided)"
              }
            },
            "required": ["eventName", "eventVersion", "accountId", "stickerId", "assignedAt"]
          }
        ]
      },
      "stickerAssignedToUserEvent": {
        "id": "stickerAssignedToUserEvent",
        "allOf": [
          {
            "$ref": "#/components/schemas/cloudEvent"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "const": "stickers.stickerAssignedToUser.v1"
              },
              "data": {
                "$ref": "#/components/schemas/stickerAssignedToUserEventData"
              }
            },
            "required": ["data"]
          }
        ]
      },
      "stickerRemovedFromUserEventData": {
        "id": "stickerRemovedFromUserEventData",
        "allOf": [
          {
            "$ref": "#/components/schemas/domainEvent"
          },
          {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "eventName": {
                "type": "string",
                "const": "StickerRemovedFromUser"
              },
              "eventVersion": {
                "type": "string",
                "const": "v1"
              },
              "accountId": {
                "type": "string",
                "description": "The user who had the sticker removed"
              },
              "stickerId": {
                "type": "string",
                "description": "The sticker that was removed"
              },
              "removedAt": {
                "type": "string",
                "format": "date-time",
                "description": "RFC3339 timestamp when the removal occurred"
              }
            },
            "required": ["eventName", "eventVersion", "accountId", "stickerId", "removedAt"]
          }
        ]
      },
      "stickerRemovedFromUserEvent": {
        "id": "stickerRemovedFromUserEvent",
        "allOf": [
          {
            "$ref": "#/components/schemas/cloudEvent"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "const": "stickers.stickerRemovedFromUser.v1"
              },
              "data": {
                "$ref": "#/components/schemas/stickerRemovedFromUserEventData"
              }
            },
            "required": ["data"]
          }
        ]
      },
      "stickerClaimedEventV1Data": {
        "id": "stickerClaimedEventV1Data",
        "allOf": [
          {
            "$ref": "#/components/schemas/domainEvent"
          },
          {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "eventName": {
                "type": "string",
                "const": "StickerClaimed"
              },
              "eventVersion": {
                "type": "string",
                "const": "v1"
              },
              "accountId": {
                "type": "string",
                "description": "The user who claimed the sticker"
              },
              "stickerId": {
                "type": "string",
                "description": "The sticker that was claimed"
              },
              "claimedAt": {
                "type": "string",
                "format": "date-time",
                "description": "RFC3339 timestamp when the claim occurred"
              }
            },
            "required": ["eventName", "eventVersion", "accountId", "stickerId", "claimedAt"]
          }
        ]
      },
      "stickerClaimedEventV1": {
        "id": "stickerClaimedEventV1",
        "allOf": [
          {
            "$ref": "#/components/schemas/cloudEvent"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "const": "users.stickerClaimed.v1"
              },
              "data": {
                "$ref": "#/components/schemas/stickerClaimedEventV1Data"
              }
            },
            "required": ["data"]
          }
        ]
      },
      "certificationCompletedEventV1": {
        "id": "certificationCompletedEventV1",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "eventName": {
            "type": "string",
            "const": "CertificationCompleted"
          },
          "eventVersion": {
            "type": "string",
            "const": "v1"
          },
          "accountId": {
            "type": "string",
            "description": "The user who completed the certification"
          },
          "certificationId": {
            "type": "string",
            "description": "The certification that was completed"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the certification was completed"
          }
        },
        "required": ["eventName", "eventVersion", "accountId", "certificationId", "completedAt"]
      },
      "userRegisteredEventV1": {
        "id": "userRegisteredEventV1",
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "eventName": {
            "type": "string",
            "const": "users.userRegistered.v1"
          },
          "eventVersion": {
            "type": "string",
            "const": "1.0"
          },
          "accountId": {
            "type": "string",
            "description": "The newly registered user"
          },
          "registeredAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the user was registered"
          }
        },
        "required": ["eventName", "eventVersion", "accountId"]
      }
    },
    "messages": {
      "stickerAssignedToUserEvent": {
        "payload": {
          "$ref": "#/components/schemas/stickerAssignedToUserEvent"
        },
        "name": "stickerAssignedToUserEvent",
        "title": "Sticker Assigned to User (CloudEvent)",
        "summary": "CloudEvent wrapper containing sticker assignment event data",
        "contentType": "application/json"
      },
      "stickerRemovedFromUserEvent": {
        "payload": {
          "$ref": "#/components/schemas/stickerRemovedFromUserEvent"
        },
        "name": "stickerRemovedFromUserEvent",
        "title": "Sticker Removed from User (CloudEvent)",
        "summary": "CloudEvent wrapper containing sticker removal event data",
        "contentType": "application/json"
      },
      "stickerClaimedEventV1": {
        "payload": {
          "$ref": "#/components/schemas/stickerClaimedEventV1"
        },
        "name": "stickerClaimedEventV1",
        "title": "Sticker Claimed (CloudEvent)",
        "summary": "CloudEvent wrapper containing sticker claim event data",
        "contentType": "application/json"
      },
      "certificationCompletedEventV1": {
        "payload": {
          "$ref": "#/components/schemas/certificationCompletedEventV1"
        },
        "name": "certificationCompletedEventV1",
        "title": "Certification Completed",
        "summary": "Event consumed to trigger automatic sticker assignments",
        "contentType": "application/json"
      },
      "userRegisteredEventV1": {
        "payload": {
          "$ref": "#/components/schemas/userRegisteredEventV1"
        },
        "name": "userRegisteredEventV1",
        "title": "User Registered",
        "summary": "Event consumed to assign welcome stickers to new users",
        "contentType": "application/json"
      }
    }
  }
}